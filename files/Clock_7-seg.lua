local function a(b)_Clock_7seg=b;pwm.setup(2,500,500)pwm.start(2)return true end;function while_led(c)local d;if adc.read(0)>_Clock_7seg.adc_trig then pwm.setup(2,500,tonumber(_Clock_7seg.pwm_day))else pwm.setup(2,500,tonumber(_Clock_7seg.pwm_night))end;pwm.start(2)if c==1 then d=dofile("Clock_7-seg_DS3231.lua")({get=true})d=string.format("%02d-%02d-20%02dT%02d:%02d",d["date"],d["month"],d["year"],d["hour"],d["min"])dofile("Clock_7-seg_lcd.lua")({step=d},function(b)while_led(2)end)end;if c==2 then d=dofile("Clock_7-seg_DS3231.lua")({temp=true})dofile("Clock_7-seg_lcd.lua")({step="t1 "..d},function(e)while_led(3)end)end;if c==3 then local f=temp and temp or"--"dofile("Clock_7-seg_lcd.lua")({step="t2 "..f},function(e)while_led(4)end)end;if c==4 then d=dofile("Clock_7-seg_DS3231.lua")({get=1})d=string.format("%02d:%02d",d["hour"],d["min"])dofile("Clock_7-seg_lcd.lua")({set=d})end end;local function g()timer=tmr.create()timer:register(60000,tmr.ALARM_AUTO,function()while_led(1)print(tmr.time())end)timer:start()end;local function h(b)local i,e;e=tonumber(b.data)if b.type~="adc_trig"and(e>0 and e<1024)then pwm.setup(2,500,b.data)pwm.start(2)i=true end;_Clock_7seg[b.type]=b.data;return i end;return function(b)local i;if b.init then i=a(b.init)end;if b.start then i=g()end;if b.pwm then i=h(b.pwm)end;return i end
